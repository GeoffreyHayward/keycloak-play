<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spring + Keycloak Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; max-width: 800px; margin: 2rem auto; }
    button, .btn { padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; text-decoration: none; display: inline-block; }
    .btn-primary { background: #2563eb; color: #fff; border-color: #2563eb; }
    .row { margin: 1rem 0; }
    code { background:#f3f4f6; padding: 2px 6px; border-radius: 4px; }
  </style>
  <script>
    function submitLogout(){
      const f = document.getElementById('logoutForm');
      if (f) f.submit();
    }
  </script>
  </head>
<body>
  <h1>Spring + Keycloak Demo</h1>

  <div class="row" sec:authorize="!isAuthenticated()">
    <a class="btn btn-primary" href="/oauth2/authorization/keycloak">Sign in</a>
  </div>

  <div class="row" sec:authorize="isAuthenticated()">
    <form id="logoutForm" th:action="@{/logout}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="button" onclick="submitLogout()">Sign out</button>
      <a class="btn" href="http://localhost:8080/auth/realms/play/account/">Open Account Console</a>
    </form>
  </div>

  <div class="row" sec:authorize="isAuthenticated()">
    <h2>Welcome <span th:text="${user!=null ? user.preferredUsername : ''}"></span></h2>
    <p><strong>Email:</strong> <span th:text="${user!=null ? user.email : ''}"></span></p>
    <p><strong>Subject:</strong> <code th:text="${user!=null ? user.subject : ''}"></code></p>
  </div>

  <div class="row" sec:authorize="!isAuthenticated()">
    <p>Not signed in.</p>
  </div>
</body>
</html>

